---
title: "Tidyverse VS Data.table"
format: pdf
---

```{r setup, include=FALSE}

library(nycflights13)
library(dplyr)
library(data.table)

```

# Compare the Tidyverse VS Data.table

```{r echo=FALSE}
# 3.3 Installing and loading Tidyverse and nycflights13 packages
if (!requireNamespace("tidyverse", quietly = TRUE)) {
  install.packages("tidyverse")}
if (!requireNamespace("nycflights13", quietly = TRUE)) {
  install.packages("nycflights13")}
suppressPackageStartupMessages(library(tidyverse))
library(nycflights13)
```

### First 6 line

```{r echo=FALSE}

# 3.4 reading data
head(flights) 
```

### Flight clean

```{r echo=FALSE}
#3.5 Basic Data Manipulation with dplyr
#install dplyr library
library(dplyr)
# Data cleaning and tidyverse
flights_clean <- flights %>%
  select(year, month, day, dep_delay, arr_delay, carrier) %>%
  filter(!is.na(dep_delay) & !is.na(arr_delay))
#3.6 Joining with airlines name
flights_clean <- flights_clean %>%
  left_join(airlines, by = "carrier")
```

```{r echo=FALSE}
# 3.7 Start new script
#3.8 ,3.9 Calculate the amount of delay and calculate flights_means
flights_means <- flights_clean %>%
  group_by(name) %>%
  summarize(
    avg_dep_delay = mean(dep_delay),
    avg_arr_delay = mean(arr_delay)
  ) %>%
  arrange(avg_dep_delay)

# Display the result
print(flights_means)
```


```{r echo=FALSE}
#4.1 install datatable package
if (!requireNamespace("data.table", quietly = TRUE)) {
  install.packages("data.table")}
library(data.table)
```


```{r echo=FALSE}
# 4.2 Use datatable to replace tydyversepipeline
flights_dt <- as.data.table(flights)
# Data cleaning and manipulation with data.table
flights_clean_dt <- flights_dt[
  !is.na(dep_delay) & !is.na(arr_delay),
  .(year, month, day, dep_delay, arr_delay, carrier)]
# Join with airlines data to get full airline names
airlines_dt <- as.data.table(airlines)
flights_clean_dt <- merge(flights_clean_dt, airlines_dt, by = "carrier", all.x = TRUE)
# Calculate the average departure and arrival delays for each airline
flights_means_dt <- flights_clean_dt[, .(
  avg_dep_delay = mean(dep_delay),
  avg_arr_delay = mean(arr_delay)
), by = name][order(avg_dep_delay)]
# Display the result
print(flights_means_dt)
```

### Tidyverse

```{r echo=FALSE}
# 4.3 Timing running time for analysis script
system.time({
  flights_clean <- flights %>%
    select(year, month, day, dep_delay, arr_delay, carrier) %>%
    filter(!is.na(dep_delay) & !is.na(arr_delay)) %>%
    left_join(airlines, by = "carrier") %>%
    group_by(name) %>%
    summarize(
      avg_dep_delay = mean(dep_delay),
      avg_arr_delay = mean(arr_delay)) %>%
    arrange(avg_dep_delay)})
```
# Timing running time for analysis script
   user  system elapsed 
  0.022   0.003   0.025 
  

### Data.table

```{r echo=FALSE}
# 4.3 Timing running time for the data.table
system.time({
  flights_clean_dt <- flights_dt[
    !is.na(dep_delay) & !is.na(arr_delay),
    .(year, month, day, dep_delay, arr_delay, carrier)
  ]
  flights_clean_dt <- merge(flights_clean_dt, airlines_dt, by = "carrier", all.x = TRUE)
  flights_means_dt <- flights_clean_dt[, .(
    avg_dep_delay = mean(dep_delay),
    avg_arr_delay = mean(arr_delay)
  ), by = name][order(avg_dep_delay)]
})
```

# Timing running time for the data.table
#   user  system elapsed 
  0.031   0.010   0.044